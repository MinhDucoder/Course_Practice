<div class="container py-4">

  {{!-- Breadcrumb --}}
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="/me/store/course">Danh sách khóa học</a></li>
      <li class="breadcrumb-item active" aria-current="page">Thùng rác {{this.deletedCount}}</li>
    </ol>
  </nav>

  {{!-- Toolbar --}}
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h4 mb-0">Thùng rác khóa học</h1>
    <div>
      <a href="/me/store/course" class="btn btn-outline-secondary me-2">
        <i class="bi bi-arrow-left-circle"></i> Quay lại
      </a>
      <form action="/me/trash/course/empty" method="POST" class="d-inline">
        <input type="hidden" name="_method" value="DELETE">
        <button type="submit" class="btn btn-danger">
          <i class="bi bi-trash3-fill"></i> Xóa sạch
        </button>
      </form>
    </div>
  </div>

  {{!-- Table --}}
  <div class="table-responsive shadow-sm">
    <table class="table table-striped table-hover align-middle mb-0">
      <thead class="table-dark text-center">
        <tr>
          <th scope="col" class="w-5">#</th>
          <th scope="col">Tên khóa học</th>
          <th scope="col">Trình độ</th>
          <th scope="col">Ngày tạo</th>
          <th scope="col" class="w-20">Hành động</th>
        </tr>
      </thead>
      <tbody>
        {{#if course.length}}
          {{#each course}}
          <tr>
            <th scope="row" class="text-center">{{sum @index 1}}</th>
            <td>{{this.title}}</td>
            <td class="text-center">
              {{#if (eq this.level "beginner")}}
                <span class="badge bg-success text-uppercase">Beginner</span>
              {{else if (eq this.level "intermediate")}}
                <span class="badge bg-warning text-dark text-uppercase">Intermediate</span>
              {{else}}
                <span class="badge bg-dark text-uppercase">Advanced</span>
              {{/if}}
            </td>
            <td class="text-center">{{formatDate this.createdAt}}</td>
            <td class="text-center">
              {{!-- Restore --}}
              <form action="/course/{{this._id}}/restore?_method=PATCH" method="POST" class="d-inline">
                <button type="submit" class="btn btn-sm btn-outline-success me-1">
                  <i class="bi bi-arrow-clockwise"></i> Khôi phục
                </button>
              </form>

              {{!-- Delete Forever --}}
              <button
                type="button"
                class="btn btn-sm btn-outline-danger"
                data-bs-toggle="modal"
                data-bs-target="#deleteModal"
                data-id="{{this._id}}"
              >
                <i class="bi bi-trash-fill"></i> Xóa vĩnh viễn
              </button>
            </td>
          </tr>
          {{/each}}
        {{else}}
          <tr>
            <td colspan="5" class="text-center py-4">
              <i class="bi bi-inbox-fill fs-2 mb-2"></i>
              <p class="mb-0">Thùng rác trống</p>
              <a href="/me/store/course" class="btn btn-outline-primary mt-2">
                <i class="bi bi-journal-check"></i> Về danh sách khóa học
              </a>
            </td>
          </tr>
        {{/if}}
      </tbody>
    </table>
  </div>

</div>

{{!-- Modal Xác nhận xóa vĩnh viễn --}}
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <form id="deleteForm" class="modal-content" method="POST" action="">
      <input type="hidden" name="_method" value="DELETE">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteModalLabel">Xác nhận xóa vĩnh viễn</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Bạn có chắc chắn muốn xóa vĩnh viễn khóa học này?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
        <button type="submit" class="btn btn-danger">Xóa vĩnh viễn</button>
      </div>
    </form>
  </div>
</div>

<script>
  // Khi modal show, set action của form delete
  document.getElementById('deleteModal')
    .addEventListener('show.bs.modal', event => {
      const button = event.relatedTarget;
      const courseId = button.getAttribute('data-id');
      document.getElementById('deleteForm')
        .action = `/course/${courseId}/deleteForce?_method=DELETE`;
    });
</script>
